function [Y,Xf,Af] = myNeuralNetworkFunction2(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 11-Apr-2016 21:57:55.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = Qx3 matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = Qx1 matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1_xoffset = [0;0;0];
x1_step1_gain = [2;2;2];
x1_step1_ymin = -1;

% Layer 1
b1 = [6.3508962173155945052;-6.3516828986963540515;-6.2563687745816096708;6.1390572216558370044;6.0096099487606116085;-5.7465154922361847412;5.7042019530216370171;-5.5605578067501797435;5.5442805156382766185;-5.3175535110147116313;5.2133556477106637317;5.1660327359213056297;-4.9731980167659708414;4.678081555204868458;-4.6390639109684617125;4.5288868868334972717;-4.4003652511600286346;4.1137056206525004498;-4.1685928040154980323;3.9622242806470961973;3.9236330184712220337;-3.7273437374887183893;-3.586828076099972229;3.4952088459700947354;3.322477716238189771;-3.4874000664579507536;3.1526686148394804654;2.9885409197344121601;-2.8139198880367062294;2.9569146466790390271;-2.556292346306964447;2.5897944553641165655;-2.2954285773947011862;2.1634580628728596885;-2.0341282290101148078;1.8915114527775116482;-1.763872229215562415;-1.6409514421690940544;-1.5215623551923569412;1.3987448701073059709;-1.2592795604884261529;1.1159007555187763217;1.0612238623764218559;0.82686360954113535815;-0.7486564242185214102;-0.59441136866814126005;-0.35885494337326051539;-0.1482876866978686814;0.22675475069617614943;-0.0056945597118051773794;0.086430705391239148749;0.10466464261320251872;0.35784046934937596696;-0.46927720137401124356;0.55569293154470689178;-0.71332002027708119041;-0.73126622671265273379;-1.0377874850884658553;1.1203306925359146629;-1.2469376078566494215;1.3636944700089419502;1.7132046182795772626;-1.6417514133702793;-1.7720555495976522131;1.8997832855124043849;2.0595193780498166625;-2.2821524622607558541;-2.2926161842559626969;2.3977801468613400004;-2.4925383064730373128;2.7343153056358819875;-2.7897498410802183955;-2.9570294508126253596;-3.0459169957650620297;-3.2120298644620040029;-3.3539267731759427882;-3.4627169341924259882;3.6956987210659542065;3.6694176684343497996;-3.9542975068356684964;-3.9757636439970558406;-4.091171248581844111;4.3369611792591244992;-4.4833669419671471346;-4.6092354420040848595;-4.6571263295925922066;-4.7947987811634131816;4.8962791986776501574;5.0268935952365207953;5.2730629167661025036;5.3417209354802706045;5.2160457934848700745;-5.5953600750743301973;-5.7074066831738159422;5.8415642162345839949;5.9010009689162306046;6.0938982836784250097;-6.4101361842385617962;-6.3669635877070698271;-6.5738163538722735879];
IW1_1 = [-4.8510652492045664985 4.3379702562776740749 1.4482096589109980656;5.8122182877176085114 -0.84685746106050041604 -2.8249845650515208462;0.46197905898965790916 2.547813960739798933 -5.9352002921557271975;-3.3464997288439053413 3.8136958128627709286 4.0216660317684214121;-3.5872425306866553285 -3.5608616414924725291 -4.0466739051238800329;4.3349174195685211686 -4.3245752963293337956 2.4290848557363799998;-3.9142814215010823808 -1.7753161061157407552 4.8825963997451227172;5.1606020210518552815 -3.7121493581778275406 1.4547737398635718353;-3.363929544873322186 -3.3727647069809996161 -4.3230445264551242701;3.5786307507191468247 0.34370319226908874199 -5.4124621020726007004;-5.6624244559847953795 -1.8940640622762427991 -2.5140484256348396563;-5.2142602408765288402 -3.0599743801044314573 2.201375723916131566;1.066867725558219071 0.65289673430108741137 -6.3572419028441649047;-2.4378091985072822823 2.2648611548687123118 -5.6932179694352003096;4.0740994508047068123 -2.7724379862302428457 4.2624335748008874702;-4.4235169971081802487 -0.36101795072889530935 4.7465816045825919289;4.4283305132966290785 -4.490952661927872569 -1.5715936286210787642;-3.8651869250901835784 -3.2821779071898351532 -4.2343779883160070909;5.9524678041031711118 2.1068857957476758713 1.4306938274614344753;-6.4900065399587374415 -0.72480376765611687073 0.21684003211014293844;-5.3015653049391131546 -3.6515979235889921561 0.73950156800866273521;3.502009119704566853 -4.3106728940745817624 3.40014628034661337;3.4993459571831060373 0.84192839889121606767 5.422499642261731978;-0.70353244835575790006 -2.4528926654683802511 5.9937155660886860531;-2.6557151611924356693 1.3943381731560229309 -5.7948306054964326961;4.1846018228101309333 4.0562439293701499921 -2.6085920451261226383;-5.1759068691470817569 0.58390167979256668573 3.8486859246190774364;-1.259207292879510387 -4.2599096822370565718 -4.7281680863903474688;2.6009961822608547166 -3.5398371046320544764 -4.8019746566032788238;-4.3439078191079714131 3.823596902290923083 -2.7035537325863923108;0.47973240704610636831 -6.4126291282495131441 0.95380338711533763085;-4.3716765607900587298 4.4896480378370533515 -1.5528252033634026841;2.388579338989510692 -3.7037996587255084258 4.7780630161111474763;-4.5731167021761320868 0.13695329248079435303 4.6142989201068047578;3.2600924769633783384 -5.0975324888924777866 2.3682519799481838163;-4.6814819187759182384 1.9228927948264362691 4.065314006271867342;4.1058293196535755598 -1.7027016947234421274 4.7452976573111680381;0.540897324175412475 -1.2876935596287160113 -6.3463601952673220907;1.171423505098542428 -5.2893470247138187901 -3.5963412183044560777;-5.7765410431725259244 -1.8536795291603180846 -2.3146461101739190802;2.3468891191937886198 0.60048151193008758586 -6.0238288912135811159;-0.23934428190956164029 -1.0437009808041819436 -6.4093632129258280017;-3.3861844992004317412 2.503740289675714159 -4.9345379039158085988;-4.4456313444856414563 4.2704405220307126712 -2.0766796757397445461;3.9449863149592778733 -4.4861326839873019168 2.5377481703491815423;4.0603902386090577892 -4.5938102095407051806 2.1482671320564494799;3.4059047259474439784 4.7552144812516106143 -2.8652010012451123444;3.11081465858876971 2.0008262928099824762 -5.3444641600886511057;-4.4174696137665376838 4.1647263200782935755 -2.3106319619667452514;-4.9994997862365124774 2.1917653054646470956 -3.5221616323645066338;5.3869179889163518737 3.5641563453020510543 -0.69912418139162535446;5.4515879128609645576 -1.4684712131770476518 -3.2279024323613780822;4.7768684384708564039 4.18591138439909205 -1.3638567970494888115;0.058722694595454746902 -5.4013644695501357162 3.6066320110855554226;3.6227111164056675641 2.1107657402928654555 -4.9684759463274321689;-4.4160959743679075729 2.0191509264858042982 4.3224065488588374606;-1.4781128637808109705 2.6029911156372489422 5.7956247850041080483;-5.0474252407735660242 2.1129209552100811642 3.4999425087814994839;0.99639847305022843926 6.1344901540344007884 1.8905158466112315097;-1.264385715867428539 -0.14176658757960694524 -6.372593382075130819;4.1834722136214326227 -1.9946529711975142796 -4.5596027845538307233;4.5296906542971449028 4.6551845609291291339 -0.065781333169186259613;-3.3590868911516711393 -3.9330140095429095837 -3.9332102256614502878;-4.0633228584412979245 -0.93619614881590718092 4.9829632507033814193;0.39002781667039670976 5.2267473907589359072 3.8435642921798507388;1.8842992053096188076 2.4634613110292344906 5.7045263862159254487;-3.2035504503831062628 4.7205439610823587415 -3.0446154633676907331;-5.0769894134119244455 -2.1653845756375931231 -3.4567135268488713429;4.8001760211466208972 2.0658778383540812307 3.8975913679799845113;-0.69346990048689061137 5.6653825115193665596 -3.1953389224579487049;1.6940670726712734329 5.6546983169329632091 -2.7213532639087008036;-5.988194488352712952 -0.51414384861087492062 -2.5032946033195488944;-0.16000996419709603846 -4.8675774135131648634 4.3011119450630301841;-2.0281768773699702102 3.1243348155350254558 5.3577655445640246512;-6.4816096910116467456 0.42318961005936356345 0.2904623280975083266;-0.48472741482315323536 -6.4731630022132788937 -0.12602545659929295652;-0.86223239426308218025 3.968753880515673238 5.0793464751497232612;4.2148863553928563874 -4.1353183501175090342 2.6364889151283197322;2.176704483570602644 3.9582827981474659751 -4.7191250953555536896;-3.5395784921006527846 4.402415913171642714 -3.1267614856522079059;-3.0364682525730155582 4.1137298813132412434 -4.0443834877255930849;-3.8223211684704154756 -1.8528203816695150152 4.9454375109313275516;1.5830532009228990287 6.2376900047022312279 -0.39519839765580383473;-5.4285633579531706872 -3.1287240617560985179 1.5169412877307300036;-3.2299533429276325869 5.442651403627065676 -1.269975648859451578;-1.2270920467721451175 -1.3376269421752318145 6.2644427273320824057;-5.4737629350924468241 0.29627922342201895578 3.4874967634832718666;4.2830546672676401698 -4.373669978957336113 2.2685067907119580433;1.1010660141233743481 2.935757047459307767 -5.7117940499979082958;1.5055345636707688772 1.5065915628617227995 6.0496363868497375904;0.8883217896417351378 0.85168932708291755773 -6.3515383135439638096;1.8321258942637543843 1.8642658530824887109 6.1819663787407090894;-2.5812583327573452863 5.9583600144017765388 0.17426371583129013354;-3.3160109012354714864 5.5912886563351511526 0.2278524613095971596;3.8420762969583122093 1.8518775334091857054 -4.9030753510741744705;3.7625411310133589637 5.0907533390727008893 1.7829092874253631429;2.3565519960246716913 -5.2278577344128480675 -3.0799430024257965499;-0.70226455673140375513 -0.9745530737763951068 6.2118576434662271524;-3.8290131378620326785 3.6867076414842405718 3.7381439758932808459;-3.9719057091166809492 1.7705354529690284782 4.7174924727232498967];

% Layer 2
b2 = 0.27003272534707906116;
LW2_1 = [-1.6389701843684507665 -0.39941018513428983017 -0.56310247673365987353 -0.77952399058884036531 1.0375134993269339301 0.81860523659708217536 0.21631730907792762197 1.2456947035320444783 0.70531771725463543454 -0.46351366600530619078 0.081953943483420915728 1.4252846040181579301 0.45067583488878021347 0.62213257340764427372 -0.12631586610281120286 0.065261139407708140814 1.2196568777664649197 -0.37269239493788114403 -0.6089939689749945817 -0.40116771263769301914 1.5082132428491925591 0.69019748617122334 0.23447116250890739919 -0.59857582762301753121 0.70724460606867067813 -1.1572099702730083148 0.66641230424423536505 0.34244009323499746689 -0.58055753972688184383 -1.0518909200033215168 -0.37332357618431100121 -1.114916519029446329 -0.26944179514265476083 -0.10144655082744113983 0.27941847199806341129 0.092583491012833363243 -0.16449751266555598384 -0.042132410505654832589 0.40809551910373059735 0.22646619399642398118 0.23570426085894957691 -0.29600910624176246522 0.30277469914266447182 0.05687837584547649622 0.47363961783085234414 0.13724341522839922369 0.50138949842260682743 -0.26113605972912001807 -0.61254051283352928259 0.10617470020770469752 0.064496401666328057045 0.17347369262749612329 0.16047451556766903491 0.35463009936015654766 -0.0040314337697163801083 0.26119329271434033046 0.47823222715458568732 0.47318395651835415405 0.19953066873334834863 -0.50530161052540079059 0.043077077337425398462 1.5805021843510629331 0.11035977895974989627 0.063092333486513649254 0.17706272451128848844 -0.37665524558629920326 0.54993883372368634888 -0.78078935631676715801 0.45739877439065285136 0.60655558222192762496 1.115833711431145403 0.03371470570826992641 0.3687909745728903399 -0.72923161456423957194 -0.48660717252334406702 -0.43338824198102726681 -0.39445899367154868553 -0.89942824583537395178 -0.48699152888858199262 0.82767221126577594781 -0.25980638101968939191 0.25499480537332858132 0.35456161145335712837 -1.0320871743028099399 1.0657112980344438657 0.76286416560112368934 -0.56128108351438177337 -1.1222056822024537581 -0.21968131106812519016 -0.048601167461298180883 -0.0067414900947597271308 -0.6967655951087712296 1.460079352952518672 1.5226408691577968391 0.19070510690882128135 1.2969384853322307727 -0.0030036316918496900469 -0.39961791803625368313 0.2777744724615439087 0.31498048702882247563];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX, X = {X}; end;

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},1); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    X{1,ts} = X{1,ts}';
    Xp1 = mapminmax_apply(X{1,ts},x1_step1_gain,x1_step1_xoffset,x1_step1_ymin);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
    Y{1,ts} = Y{1,ts}';
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX, Y = cell2mat(Y); end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings_gain,settings_xoffset,settings_ymin)
y = bsxfun(@minus,x,settings_xoffset);
y = bsxfun(@times,y,settings_gain);
y = bsxfun(@plus,y,settings_ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n)
a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
